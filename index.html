<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>99 Nights – Survival Prototype</title>
<style>
  :root{
    --ui:#e7f0ff; --muted:#b8c4da; --accent:#ff2f86; --ok:#2dd4bf; --warn:#f59e0b;
  }
  html,body{margin:0;height:100%;background:#0a0d13;color:var(--ui);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  #wrap{position:fixed;inset:0;display:grid;grid-template-rows:auto 1fr}
  .top{display:flex;gap:14px;align-items:center;padding:8px 12px;background:#0b1220;border-bottom:1px solid #1b2a45}
  .tag{padding:4px 8px;border:1px solid #1b2a45;border-radius:999px;color:var(--muted);font-weight:600}
  .hud{position:fixed;left:12px;top:56px;display:flex;gap:10px;z-index:5}
  .kpi{background:#0b1220;border:1px solid #1b2a45;border-radius:10px;padding:8px 10px;min-width:130px}
  .kpi b{font-size:18px}
  .tip{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#0b1220;border:1px solid #1b2a45;border-radius:10px;padding:8px 12px;color:var(--muted)}
  .craft{position:fixed;right:12px;top:56px;background:#0b1220;border:1px solid #1b2a45;border-radius:12px;padding:12px;min-width:220px;display:none;z-index:6}
  .craft.show{display:block}
  .craft h3{margin:0 0 8px 0;font-size:16px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:8px;margin:6px 0}
  button{background:#12203a;color:#e9f1ff;border:1px solid #1b2a45;border-radius:10px;padding:6px 10px;font-weight:700;cursor:pointer}
  button:disabled{opacity:.45;cursor:not-allowed}
  .firebar{height:8px;background:#142544;border:1px solid #1b2a45;border-radius:999px;overflow:hidden}
  .firebar span{display:block;height:100%;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444)}
  canvas{display:block;width:100%;height:100%;background:linear-gradient(#0a0f18,#0e1426 65%,#0a0f18)}
</style>
</head>
<body>
  <div id="wrap">
    <div class="top">
      <span class="tag">Mozgás: A / D vagy ← →</span>
      <span class="tag">Ugrás: Space / W / ↑</span>
      <span class="tag">Vágás: E</span>
      <span class="tag">Tűzre fa: F</span>
      <span class="tag">Fa-prés: C</span>
    </div>
    <div class="hud" id="hud">
      <div class="kpi">Rönk: <b id="k-logs">0</b></div>
      <div class="kpi">Deszka: <b id="k-planks">0</b></div>
      <div class="kpi">Kerítés: <b id="k-fence">0</b></div>
      <div class="kpi" style="min-width:180px">
        Tűz: <b id="k-firep">100%</b>
        <div class="firebar"><span id="k-firebar" style="width:100%"></span></div>
      </div>
    </div>
    <div class="craft" id="craft">
      <h3>Fa-prés (C bezár)</h3>
      <div class="row"><div>Rönk ➜ 2× Deszka</div><button id="craftPlank">Készít</button></div>
      <div class="row"><div>Deszka ×2 ➜ 1× Kerítés</div><button id="craftFence">Készít</button></div>
      <div class="row" style="color:var(--muted);font-size:12px">Recept: rönk (E vágás fáknál), F tűzre dob</div>
    </div>
    <canvas id="game" width="1280" height="720"></canvas>
    <div class="tip" id="tip">Közelíts a fához (E vág), a tűzhöz (F fa a tűzre), a préshez (C craft)</div>
  </div>

<script>
(()=> {
// ====== Canvas / kamera ======
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
ctx.imageSmoothingEnabled = false;

const W = cvs.width, H = cvs.height;
let cam = { x:0, y:0 };

// ====== Világ paraméterek ======
const world = {
  width: 6000, // hosszú pálya
  ground: H - 120,
  gravity: 0.7,
};

// ====== Játékos (sziluett – később cseréljük real sprite-ra) ======
const player = {
  x: 300, y: world.ground - 64, w: 36, h: 64,
  vx: 0, vy: 0,
  speed: 2.8, jump: 12,
  facing: 1, onGround: true,
  swingCooldown: 0, // balta CD
};

// ====== Készletek / UI ======
const inv = { logs: 0, planks: 0, fence: 0 };
const $logs = id('k-logs'), $planks = id('k-planks'), $fence = id('k-fence');
const $firep = id('k-firep'), $firebar = id('k-firebar');

// ====== Tábortűz ======
const fire = {
  x: 200, y: world.ground - 30, r: 28,
  fuel: 100, // %
  burnRate: 0.6, // %-pont / másodperc
};

// ====== Fa-prés állomás ======
const press = {
  x: 520, y: world.ground - 40, w: 60, h: 40,
  open: false,
};
const $craft = id('craft');
id('craftPlank').onclick = ()=>{
  if(inv.logs >= 1){ inv.logs -= 1; inv.planks += 2; refreshHUD(); }
};
id('craftFence').onclick = ()=>{
  if(inv.planks >= 2){ inv.planks -= 2; inv.fence += 1; refreshHUD(); }
};

// ====== Fák (HP-val) ======
const trees = [];
function addTree(x){
  trees.push({ x, y: world.ground - 90, w: 36, h: 90, hp: 3, alive:true, shake:0 });
}
// sok fa a pályán
for(let i=0;i<60;i++){
  const x = 800 + i*80 + (Math.random()*80-40);
  addTree(x);
}

// ====== Input ======
const keys = { left:false, right:false, up:false };
window.addEventListener('keydown',e=>{
  const k = e.key.toLowerCase();
  if(['a','arrowleft'].includes(k)) keys.left = true;
  if(['d','arrowright'].includes(k)) keys.right = true;
  if(['w','arrowup',' '].includes(k)) keys.up = true;

  if(k==='e') trySwing();
  if(k==='f') tryFeedFire();
  if(k==='c') toggleCraft();
});
window.addEventListener('keyup',e=>{
  const k = e.key.toLowerCase();
  if(['a','arrowleft'].includes(k)) keys.left = false;
  if(['d','arrowright'].includes(k)) keys.right = false;
  if(['w','arrowup',' '].includes(k)) keys.up = false;
});

// ====== Segédek ======
function id(s){ return document.getElementById(s); }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
function dist(a,b){ const dx=a.x-b.x, dy=(a.y+a.h/2)-(b.y+b.h/2); return Math.hypot(dx,dy); }
function near(a,b,range){ return dist(a,b) <= range; }

function refreshHUD(){
  $logs.textContent = inv.logs;
  $planks.textContent = inv.planks;
  $fence.textContent = inv.fence;
  const p = clamp(fire.fuel,0,100)|0;
  $firep.textContent = p + '%';
  $firebar.style.width = p + '%';
}

// ====== Interakciók ======
function trySwing(){
  if(player.swingCooldown>0) return;
  // legközelebbi fa a közelben
  let best = null, bestD=1e9;
  for(const t of trees){
    if(!t.alive) continue;
    const d = Math.abs((t.x + t.w/2) - (player.x + player.w/2));
    if(d < bestD){ best=t; bestD=d; }
  }
  if(best && bestD < 60 && Math.abs((player.y+player.h) - (best.y+best.h)) < 30){
    // ütés
    best.hp--; best.shake = 8;
    player.swingCooldown = 0.25; // 250ms
    if(best.hp<=0){
      best.alive=false;
      inv.logs += 1 + (Math.random()<0.25 ? 1:0); // 1-2 rönk
      refreshHUD();
    }
  }
}
function tryFeedFire(){
  const fobj = {x:fire.x-20,y:fire.y-20,w:40,h:40};
  if(inv.logs>0 && near(player, fobj, 70)){
    inv.logs--; fire.fuel = clamp(fire.fuel + 25, 0, 100);
    refreshHUD();
  }
}
function toggleCraft(){
  const pobj={x:press.x,y:press.y,w:press.w,h:press.h};
  if(near(player, pobj, 90)){
    press.open = !press.open;
    $craft.classList.toggle('show', press.open);
  } else {
    press.open = false;
    $craft.classList.remove('show');
  }
}

// ====== Update ======
let last = performance.now()/1000;
function update(){
  const now = performance.now()/1000;
  const dt = Math.min(0.033, now - last); last = now;

  // tűz ég
  fire.fuel = clamp(fire.fuel - fire.burnRate*dt, 0, 100);

  // játékos fizika
  if(keys.left){ player.vx -= 0.6; player.facing = -1; }
  if(keys.right){ player.vx += 0.6; player.facing = 1; }
  if(keys.up && player.onGround){ player.vy = -player.jump; player.onGround=false; }

  player.vx *= (player.onGround? 0.85 : 0.98);
  player.vx = clamp(player.vx, -5, 5);
  player.vy += world.gravity;

  player.x += player.vx;
  player.y += player.vy;

  // talaj / pályaszél
  if(player.y + player.h >= world.ground){
    player.y = world.ground - player.h;
    player.vy = 0; player.onGround = true;
  }
  player.x = clamp(player.x, 0, world.width - player.w);

  // balta CD
  if(player.swingCooldown>0) player.swingCooldown -= dt;

  // fa „shake” csillapítás
  for(const t of trees){ if(t.shake>0) t.shake -= 40*dt; if(t.shake<0) t.shake=0; }

  // kamera követés
  cam.x = clamp( player.x + player.w/2 - W/2, 0, world.width - W);
  cam.y = 0;

  refreshHUD();
}

// ====== Rajz ======
function draw(){
  ctx.clearRect(0,0,W,H);

  // Parallax háttér dísz
  ctx.fillStyle = '#0b1220';
  ctx.fillRect(0, H-160, W, 160);
  ctx.fillStyle = '#0d1a32';
  for(let i=0;i<8;i++){
    const x = (i*400 - cam.x*0.3)% (W+400) - 200;
    ctx.fillRect(x, H-200, 300, 80);
  }

  ctx.save();
  ctx.translate(-cam.x, -cam.y);

  // Talaj
  ctx.fillStyle = '#0f1628';
  ctx.fillRect(0, world.ground, world.width, H - world.ground);
  ctx.fillStyle = '#16243f';
  for(let i=0;i<world.width;i+=40){
    ctx.fillRect(i, world.ground-6, 28, 6);
  }

  // Tábortűz
  drawFire(fire);

  // Fa-prés
  drawPress(press);

  // Fák
  for(const t of trees){
    if(!t.alive) continue;
    const shake = (t.shake>0 ? (Math.random()*t.shake - t.shake/2) : 0);
    drawTree(t.x+shake, t.y, t.w, t.h, t.hp);
  }

  // Játékos (sziluett + balta jelzés)
  drawPlayer(player);

  ctx.restore();

  // közelben lévő interakció tip
  const nearFire = near(player, {x:fire.x-20,y:fire.y-20,w:40,h:40}, 80);
  const nearPress = near(player, {x:press.x,y:press.y,w:press.w,h:press.h}, 110);

  const tip = id('tip');
  let txt = 'Közelíts a fához (E vág), a tűzhöz (F), a préshez (C)';
  if(nearFire) txt = 'Tábortűz – F: rönk a tűzre';
  if(nearPress) txt = 'Fa-prés – C: craft panel';
  tip.textContent = txt;
}

function drawPlayer(p){
  const {x,y,w,h} = p;
  // árnyék
  ctx.fillStyle = 'rgba(0,0,0,.35)';
  ctx.beginPath(); ctx.ellipse(x+w/2, y+h, w*0.6, 8, 0, 0, Math.PI*2); ctx.fill();
  // test sziluett
  ctx.fillStyle = '#111722';
  ctx.fillRect(x+6, y+10, w-12, h-16);
  // fej
  ctx.fillStyle = '#0f1522';
  ctx.fillRect(x+8, y, w-16, 14);
  // kéz „balta” jelzéssel amikor cooldown aktív
  ctx.fillStyle = '#182237';
  ctx.fillRect(x + (p.facing>0?w-10:2), y+24, 8, 10);
  if(p.swingCooldown>0){
    ctx.fillStyle = '#9bb7ff';
    ctx.fillRect(x + (p.facing>0?w: -6), y+16, 12, 4); // balta penge jel
  }
}

function drawTree(x,y,w,h,hp){
  // törzs
  ctx.fillStyle = '#2a3c58';
  ctx.fillRect(x+w/2-6, y+20, 12, h-20);
  // lomb
  ctx.fillStyle = '#1e2d49';
  ctx.beginPath();
  ctx.ellipse(x+w/2, y+18, 34, 22, 0, 0, Math.PI*2); ctx.fill();
  ctx.ellipse(x+w/2-18, y+28, 24, 18, 0, 0, Math.PI*2); ctx.fill();
  ctx.ellipse(x+w/2+18, y+28, 24, 18, 0, 0, Math.PI*2); ctx.fill();
  // HP csík
  ctx.fillStyle = '#0b1220';
  ctx.fillRect(x+w/2-18, y-10, 36, 6);
  const ratio = hp/3;
  ctx.fillStyle = ratio>0.66?'#22c55e':ratio>0.33?'#f59e0b':'#ef4444';
  ctx.fillRect(x+w/2-18, y-10, 36*ratio, 6);
}

function drawFire(f){
  // parázs
  ctx.fillStyle = '#1a2338';
  ctx.beginPath(); ctx.arc(f.x, f.y+26, 20, 0, Math.PI*2); ctx.fill();
  // láng (üzemanyag arányos magasság)
  const h = 16 + 20*(f.fuel/100);
  const w = 14 + 10*(f.fuel/100);
  const flick = (Math.sin(performance.now()/90)+1)*0.5;
  ctx.fillStyle = `rgb(${220+30*flick}, ${120+80*flick}, 40)`;
  ctx.beginPath();
  ctx.ellipse(f.x, f.y, w, h, 0, 0, Math.PI*2); ctx.fill();
  // rönkök
  ctx.fillStyle = '#273754';
  ctx.fillRect(f.x-24, f.y+18, 48, 8);
}

function drawPress(p){
  // talp
  ctx.fillStyle = '#1a2744';
  ctx.fillRect(p.x-30, p.y+p.h-8, 60, 10);
  // test
  ctx.fillStyle = '#203457';
  ctx.fillRect(p.x-30, p.y- p.h, 60, p.h);
  // pofa
  ctx.fillStyle = '#9bb7ff';
  ctx.fillRect(p.x-20, p.y- p.h - 10, 40, 10);
  // felirat
  ctx.fillStyle = '#b8c4da';
  ctx.font = '12px monospace';
  ctx.fillText('PRESS', p.x-18, p.y- p.h + 14);
}

// ====== Loop ======
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
refreshHUD();
loop();
})();
</script>
</body>
</html>
